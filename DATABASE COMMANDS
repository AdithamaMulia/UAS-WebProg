create database dbgraciaschool1;

CREATE TABLE graciauser (
    userID INT NOT NULL AUTO_INCREMENT,
    username VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    nama_depan VARCHAR(255) NOT NULL,
    nama_belakang VARCHAR(255),
    password VARCHAR(255) NOT NULL,
    gender VARCHAR(50),
    tanggal_lahir DATE,
    alamat VARCHAR(255),
    nik VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    role ENUM('student', 'teacher', 'admin') NOT NULL,
    PRIMARY KEY (userID),
    INDEX idx_nama_depan (nama_depan),
    INDEX idx_nama_belakang (nama_belakang)
);

CREATE TABLE kelas (
    kelasID INT NOT NULL AUTO_INCREMENT,
    userID INT,
    nama_kelas VARCHAR(500) NOT NULL,
    deskripsi VARCHAR(500),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(kelasID),
    FOREIGN KEY(userID) REFERENCES graciauser(userID),
    INDEX idx_nama_kelas (nama_kelas)
);

CREATE TABLE absensi (
    absenID INT NOT NULL AUTO_INCREMENT,
    kelasID INT NOT NULL,
    userID INT NOT NULL,
    tanggal DATE NOT NULL,
    keterangan ENUM('Hadir', 'Sakit', 'Izin', 'Tanpa Keterangan') NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(absenID),
    FOREIGN KEY(kelasID) REFERENCES kelas(kelasID),
    FOREIGN KEY(userID) REFERENCES graciauser(userID)
);

CREATE TABLE mapel (
    mapelID INT NOT NULL AUTO_INCREMENT,
    nama_mapel VARCHAR(500) NOT NULL,
    userID INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(mapelID),
    FOREIGN KEY(userID) REFERENCES graciauser(userID),
    INDEX idx_nama_mapel (nama_mapel)
);

CREATE TABLE nilai (
    nilaiID INT NOT NULL AUTO_INCREMENT,
    userID INT NOT NULL,
    mapelID INT NOT NULL,
    nilaiT1 DOUBLE,
    nilaiT2 DOUBLE,
    nilaiT3 DOUBLE,
    nilaiUTS DOUBLE,
    nilaiUAS DOUBLE,
    nilaiUH1 DOUBLE,
    nilaiUH2 DOUBLE,
    nilaiAkhir DOUBLE,
    semester VARCHAR(10),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(nilaiID),
    FOREIGN KEY(userID) REFERENCES graciauser(userID),
    FOREIGN KEY(mapelID) REFERENCES mapel(mapelID),
    INDEX idx_semester (semester)
);